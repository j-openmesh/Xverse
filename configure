# !/usr/bin/env bash
# The project provides ./configure exclusively for traditional ./configure, make, make install workflow compatibility.
# Please use ./xvs directly, if possible. Reference COMPATIBILITY.md in this directory for further information, if available.

set -e
set -u

__XVS_SYSTEM_LOG_ENABLED=${__XVS_SYSTEM_LOG_ENABLED:-1}
__XVS_SYSTEM_LOG_COMMAND=${__XVS_SYSTEM_LOG_COMMAND:-echo}

log() {
  if [ ${__XVS_SYSTEM_LOG_ENABLED} -gt 0 ]; then
    $__XVS_SYSTEM_LOG_COMMAND ${1} ${2}
  fi
}

if [ -z "$(which gnumake)" ]; then
  __XVS_SYSTEM_COMPATIBILITY_BUILDER_MODE="gnumake"
else if [ -z "$(which make)"]; then
  __XVS_SYSTEM_COMPATIBILITY_BUILDER_MODE="make"
else
  log critical "No suitable make utility found. Please see _README.md_."
  exit 1
fi
fi

export __XVS_PROJECT_ROOT_PATH="$(dirname $0)"
export __XVS_PROJECT_ROOT_XVS_PATH="${__XVS_PROJECT_ROOT_PATH}/.xvs"
export __XVS_PROJECT_ROOT_XVS_SYSTEM_COMPATIBILITY_BUILDER_PROGRAM_BASE_PATH="${__XVS_PROJECT_ROOT_XVS_PATH}/system/builder/compatibility"

cp "${__XVS_PROJECT_ROOT_XVS_SYSTEM_COMPATIBILITY_BUILDER_PROGRAM_BASE_PATH}/project.${__XVS_SYSTEM_COMPATIBILITY_BUILDER_MODE}" ${__XVS_PROJECT_ROOT_PATH}/makefile
