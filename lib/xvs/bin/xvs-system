#! /usr/bin/env nix-shell
#! nix-shell -q -i bash -p bash

set -e
set -u

__XVS_EXECUTABLE_RUNTIME_NAME="xvs"
__XVS_EXECUTABLE_RUNTIME_SYSTEM_BOOTSTRAP_NAME="xvs-bootstrap"

__XVS_PROJECT_BIN_PATH=$(cd "$(dirname "$(readlink "$0" || echo "$0")")" && pwd)
__XVS_PROJECT_PATH="${__XVS_PROJECT_BIN_PATH}/.."

__XVS_PROJECT_OUT_PATH="${__XVS_PROJECT_PATH}/out"
__XVS_PROJECT_OUT_BIN_PATH="${__XVS_PROJECT_OUT_PATH}/bin"

__XVS_PROJECT_LIB_PATH="${__XVS_PROJECT_PATH}/lib"
__XVS_PROJECT_LIB_BOOTSTRAP_PATH="${__XVS_PROJECT_LIB_PATH}/bootstrap"

__XVS_EXECUTABLE_RUNTIME_PATH="${__XVS_PROJECT_OUT_BIN_PATH}/${__XVS_EXECUTABLE_RUNTIME_NAME}"
__XVS_EXECUTABLE_RUNTIME_SYSTEM_BOOTSTRAP_PATH="${__XVS_PROJECT_LIB_BOOTSTRAP_PATH}/${__XVS_EXECUTABLE_RUNTIME_SYSTEM_BOOTSTRAP_NAME}"

if [ -e "${__XVS_EXECUTABLE_RUNTIME_PATH}" ]
then
  exec "${__XVS_EXECUTABLE_RUNTIME_PATH}"
else
  exec "${__XVS_EXECUTABLE_RUNTIME_SYSTEM_BOOTSTRAP_PATH}"
fi
